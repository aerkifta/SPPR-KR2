@using WEB_253551_KORZUN.Domain.Models
@model ListModel<WEB_253551_KORZUN.Domain.Entities.CarPart>

@* @{
    Layout = null;
} *@

@{
    ViewBag.Title = "Каталог";

    var currentCategory = ViewData["currentCategory"] as string ?? "Все";
    var categories = ViewData["categories"] as List<Category> ?? new List<Category>();
}


<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
</head>
<body>
    @* <p>
        <a asp-action="Create">Create New</a>
    </p> *@

    <div class="row">
        <div class="col-2 border-2">
            <ul class="nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle"
                       data-bs-toggle="dropdown"
                       href="#"
                       role="button"
                       aria-expanded="false">
                        @currentCategory
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item"
                               asp-controller="Product"
                               asp-action="Index"
                               asp-route-category="@null">
                                Все
                            </a>
                        </li>

                        @foreach (var item in categories)
                        {
                            <li>
                                <a class="dropdown-item"
                                   asp-controller="Product"
                                   asp-action="Index"
                                   asp-route-category="@item.NormalizedName">
                                    @item.Name
                                </a>
                            </li>
                        }
                    </ul>
                </li>
            </ul>
        </div>


        <div class="col-10">
            <div class="row">
                @foreach (var item in Model.Items)
                {
                    <div class="col-md-4 mb-4">
                        <div class="card h-100">
                            <img src="@item.Image" class="card-img-top" alt="@item.Name" style="height: 200px; object-fit: cover;">

                            <div class="card-body d-flex flex-column">
                    
                                <h5 class="card-title">@item.Name</h5>

                         
                                <p class="card-text flex-grow-1">@item.Description</p>

                      
                                <p class="card-text">
                                    <strong>Цена: </strong>@item.Price руб.
                                </p>

                       
                                <p class="card-text">
                                    <small class="text-muted">@item.Category?.Name</small>
                                </p>


                                @{
                                    var request = ViewContext.HttpContext.Request;
                                    var returnUrl = request.Path + request.QueryString.ToUriComponent();
                                }
                                <a asp-controller="Cart"
                                   asp-action="Add"
                                   asp-route-id="@item.Id"
                                   asp-route-returnUrl="@returnUrl"
                                   class="btn btn-outline-primary mt-auto">
                                    <i class="fa-solid fa-cart-shopping"></i> Добавить в корзину
                                </a>
                            </div>
                        </div>
                    </div>
                }
            </div>

            @if (Model.TotalPages > 1)
            {
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                        @{
                            int prevPage = Model.CurrentPage > 1 ? Model.CurrentPage - 1 : 1;
                        }
                        <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                            <a class="page-link"
                               asp-controller="Product"
                               asp-action="Index"
                               asp-route-category="@ViewData["currentCategoryNormalizedName"]"
                               asp-route-pageNo="@prevPage">
                                &laquo;
                            </a>
                        </li>

                        @for (int i = 1; i <= Model.TotalPages; i++)
                        {
                            <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                <a class="page-link"
                                   asp-controller="Product"
                                   asp-action="Index"
                                   asp-route-category="@ViewData["currentCategoryNormalizedName"]"
                                   asp-route-pageNo="@i">
                                    @i
                                </a>
                            </li>
                        }

                        @{
                            int nextPage = Model.CurrentPage < Model.TotalPages ? Model.CurrentPage + 1 : Model.TotalPages;
                        }
                        <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                            <a class="page-link"
                               asp-controller="Product"
                               asp-action="Index"
                               asp-route-category="@ViewData["currentCategoryNormalizedName"]"
                               asp-route-pageNo="@nextPage">
                                &raquo;
                            </a>
                        </li>

                    </ul>
                </nav>
            }
        </div>
    </div>
    @* 
<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Id)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Description)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Price)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.CategoryId)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Image)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.MimeType)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model) {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Id)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Description)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Price)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.CategoryId)
            </td>
            <td>
                <img src="@item.Image" width="120" />
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.MimeType)
            </td>
            <td>
                @Html.ActionLink("Edit", "Edit", new { /* id=item.PrimaryKey */ }) |
                @Html.ActionLink("Details", "Details", new { /* id=item.PrimaryKey */ }) |
                @Html.ActionLink("Delete", "Delete", new { /* id=item.PrimaryKey */ })
            </td>
        </tr>
}
    </tbody>
</table>  
*@

</body>
</html>